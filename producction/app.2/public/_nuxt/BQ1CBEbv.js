import{N as _,O as k,P as w,J as g,B as S,Q as $,j as x}from"./-XG8-ux0.js";const P="$s";function c(...a){const i=typeof a[a.length-1]=="string"?a.pop():void 0;typeof a[0]!="string"&&a.unshift(i);const[s,e]=a;if(!s||typeof s!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+s);if(e!==void 0&&typeof e!="function")throw new Error("[nuxt] [useState] init must be a function: "+e);const o=P+s,r=_(),l=k(r.payload.state,o);if(l.value===void 0&&e){const u=e();if(w(u))return r.payload.state[o]=u,u;l.value=u}return l}const A=()=>{const a="https://api.ganaconleadershoes.com/api";return{register:async o=>await $fetch(`${a}/auth/register`,{method:"POST",body:o}),login:async o=>await $fetch(`${a}/auth/login`,{method:"POST",body:o}),getProfile:async o=>await $fetch(`${a}/users/me`,{method:"GET",headers:{Authorization:`Bearer ${o}`}})}},b=()=>{const a=(t,n)=>{{const f=localStorage.getItem(t);try{return f!==null?JSON.parse(f):n}catch{return n}}return n},i=(t,n)=>{localStorage.setItem(t,JSON.stringify(n))},s=t=>{localStorage.removeItem(t)},e=c("auth_token",()=>a("auth_token",null)),o=c("auth_user",()=>a("auth_user",null)),r=c("auth_loading",()=>!1);g(e,t=>{t?i("auth_token",t):s("auth_token")}),g(o,t=>{t?i("auth_user",t):s("auth_user")});const{login:l,register:u,getProfile:p}=A(),y=async t=>{r.value=!0;try{const n=await l(t);e.value=n.token,o.value=n.user}catch(n){throw n}finally{r.value=!1}},v=async t=>{r.value=!0;try{const n=await u(t);e.value=n.token,o.value=n.user}catch(n){throw n}finally{r.value=!1}},m=async()=>{if(e.value)try{const t=await p(e.value);o.value=t}catch{h()}},d=x(),h=()=>{e.value=null,o.value=null,s("auth_token"),s("auth_user"),$(()=>{d.push("/")})};return e.value||(e.value=a("auth_token",null)),o.value||(o.value=a("auth_user",null)),{token:e,user:o,loading:r,login:y,register:v,fetchUser:m,logout:h,isLoggedIn:S(()=>!!e.value)}};export{b as u};
