import{r as n,B as q,g as N,j as $}from"./-XG8-ux0.js";function w(v,r=2,g=1e3){const t=n(r),o=n(r),s=n(!1),u=n(g),i=n(""),d="https://api.ganaconleadershoes.com/api",f=q(()=>t.value*v),y=$(),h=()=>{t.value<u.value&&t.value++,o.value=null},m=()=>{t.value>r&&t.value--,o.value=null},S=e=>{o.value=e,t.value=e,localStorage.setItem("selectedQuantity",e.toString())},I=()=>{t.value=r,o.value=r},k=async(e,l)=>{s.value=!0;try{const a=await $fetch(`${d}/raffle/preorders`,{method:"POST",body:{slug:e.slug,quantity:t.value,user:l}});a.token&&localStorage.setItem("token",a.token),localStorage.setItem("checkoutUser",JSON.stringify(l)),y.push({path:`/checkout/${e.slug}`,query:{orderId:a.orderId,quantity:t.value.toString(),total:a.total.toString(),slug:e.slug}})}catch(a){console.error("❌ Error al crear la preorden:",a),i.value="No se pudo crear la orden. Intente nuevamente."}finally{s.value=!1}},O=async(e,l,a,T,b)=>{s.value=!0;try{const p=await(await fetch(`${d}/order/validate/payment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,raffleSlug:l,quantity:a,total:T,orderId:b})})).json();return localStorage.setItem("paidOrdenApprove",JSON.stringify(p)),{success:!0,data:p}}catch(c){return console.error("❌ Error en submitTicket:",c),{success:!1,error:c}}finally{s.value=!1}};return N(()=>{const e=localStorage.getItem("selectedQuantity");e&&(t.value=parseInt(e),o.value=parseInt(e))}),{quantity:t,selectedOption:o,isProcessing:s,total:f,tooltip:i,remaining:u,selectOption:S,increment:h,decrement:m,reset:I,checkout:k,submitTicket:O}}export{w as u};
